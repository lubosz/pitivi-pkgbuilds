# Contributor: atie H. <atie.at.matrix@gmail.com>
# Maintainer: alesko <askondro@gmail.com>

pkgname=clutter-git
pkgver=1.15.1.8296.8df5aba
pkgrel=1
pkgdesc="A GObject based library for creating fast, visually rich graphical user interfaces"
arch=('i686' 'x86_64')
url="http://clutter-project.org/"
license=('LGPL')
depends=('cogl' 'mesa' 'json-glib' 'atk' 'libxi' 'glib2')
options=('!libtool' '!strip')
provides=('clutter='$pkgver)
conflicts=('clutter' 'clutter-svn')
source=()
md5sums=()

source=("git://git.gnome.org/clutter#branch=clutter-1.16")
md5sums=("SKIP")
gitname="clutter"

pkgver() {
  cd $gitname
  
  s="m4_define(\[clutter_"
  
  maj=$(grep $s"major" configure.ac | sed 's/'$s'major_version\], \[//' | sed 's/\])//')
  min=$(grep $s"minor_version" configure.ac | sed 's/'$s'minor_version\], \[//' | sed 's/\])//')
  mic=$(grep $s"micro_version" configure.ac | sed 's/'$s'micro_version\], \[//' | sed 's/\])//')
  
  version=$maj.$min.$mic
  hash=$(git log --pretty=format:'%h' -n 1)
  revision=$(git rev-list --count HEAD)
  
  echo $version.$revision.$hash
}

build() {
  cd $gitname
  ./autogen.sh --prefix=/usr \
    --enable-wayland-backend=yes \
    --enable-wayland-compositor=yes \
    --enable-egl-backend=yes \
    --disable-examples \
    --disable-tests

  make 

}

package() {
  cd $gitname
  make DESTDIR=$pkgdir install 
}
